var NAILS_Admin_CMS_Blocks;NAILS_Admin_CMS_Blocks=function(){this.new_counter=0,this.block_type="plaintext",this.init_search=function(){var t=this;$(".search-text input").on("keyup",function(){return t._do_search($(this).val()),!1})},this._do_search=function(t){$("tr.block").each(function(){var e=new RegExp(t,"gi");e.test($(this).attr("data-title"))?$(this).show():$(this).hide()})},this.init_create=function(){this._init_type_change()},this._init_type_change=function(){$("select[name=type]").on("change",$.proxy(function(){this._type_changed()},this)),this._type_changed()},this._type_changed=function(){var t=$("select[name=type]").val();switch(t){case"plaintext":$("#default-value").show(),$("#ckeditor-warn").hide(),"undefined"!=typeof CKEDITOR.instances.default_value&&CKEDITOR.instances.default_value.destroy();break;case"richtext":$("#default-value").show(),$("#ckeditor-warn").show(),CKEDITOR.replace("default_value",{customConfig:window.NAILS.URL+"js/libraries/ckeditor/ckeditor.config.min.js"});break;default:$("#default-value").hide(),$("#ckeditor-warn").hide(),"undefined"!=typeof CKEDITOR.instances.default_value&&CKEDITOR.instances.default_value.destroy()}},this.init_edit=function(t){this.block_type=t,this._init_new_translation(),this._init_del_translation(),this._init_toggle_revision(),this._init_form_validation();var e=this;$(document).on("change",".translation select",function(){return e._lang_change($(this)),!1})},this._init_new_translation=function(){$("#new-translation").on("click",$.proxy(function(){return this._add_translation(),!1},this))},this._add_translation=function(){var t={new_count:this.new_counter},e=$("#template-translation").html(),i=$("<fieldset>").addClass("translation");i.html(Mustache.render(e,t)),i.attr("data-translation_id",this.new_counter).find("select").prepend($("<option>").attr({value:"",selected:"selected","class":"please-choose",disabled:"disabled"}).text("Please Choose Language...")),$(".translation").last().after(i),this._lang_disable(),"richtext"===this.block_type&&CKEDITOR.replace("translation_"+this.new_counter,{customConfig:window.NAILS.URL+"js/libraries/ckeditor/ckeditor.config.min.js"}),this.new_counter++},this._init_del_translation=function(){var t=this;$(document).on("click","a.remove-translation",function(){return t._del_translation($(this)),!1})},this._del_translation=function(t){if("richtext"===this.block_type){var e=t.closest("fieldset").attr("data-translation_id");e="translation_"+e,CKEDITOR.instances[e].destroy()}t.closest("fieldset").remove()},this._lang_change=function(t){t.closest("fieldset").attr("data-language",t.val()),this._lang_disable()},this._lang_disable=function(){$(".translation option[disabled=disabled]:not(.please-choose)").removeAttr("disabled"),$(".translation").each(function(){$(".translation option[value="+$(this).attr("data-language")+"]").attr("disabled","disabled"),$("option[value="+$(this).attr("data-language")+"]",this).removeAttr("disabled")}),$(".translation option[selected=selected]:not(.please-choose)").removeAttr("disabled")},this._init_toggle_revision=function(){var t=this;$("a.toggle-revisions").on("click",function(){return t._toggle_revision($(this)),!1})},this._toggle_revision=function(t){t.closest(".revisions").toggleClass("show")},this._init_form_validation=function(){var t=this;$("form").on("submit",function(){return t._form_validation()})},this._form_validation=function(){var t=0;if($("fieldset.translation").each(function(){var e;e=$("select",this).length?$("select",this).val():!0;var i=$("textarea",this).val();e&&i?$(".system-alert",this).hide():(t++,$(".system-alert",this).show())}),t){var e=$("div.system-alert.error:visible").get(0);return $.scrollTo(e,"fast",{axis:"y",offset:{top:-50}}),!1}return!0}};