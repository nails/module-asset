var NAILS_Admin_CMS_Menus_Create_Edit;NAILS_Admin_CMS_Menus_Create_Edit=function(){this._item_template="",this._id_length=32,this.init=function(t){var e=this;this._item_template=$("#template-item").html(),$("div.nested-sortable").each(function(){var i,n;i=$(this).children("ol.nested-sortable").first();for(var a in t){t[a].counter=$("li.target").length,n=Mustache.render(e._item_template,t[a]);var r;r=null!==t[a].parent_id&&""!==t[a].parent_id?$("li.target-"+t[a].parent_id+" ol.nested-sortable-sub").first():i,r.append(n)}i.nestedSortable({handle:"div.handle",items:"li",toleranceElement:"> div",stop:function(){e._update_orders(i),e._update_parent_ids(i)}}),$(this).find("a.add-item").on("click",function(){var t={id:e._generate_id(),counter:$("li.target").length},n=Mustache.render(e._item_template,t);return i.append(n),e._update_orders(),!1})}),$(document).on("click","a.item-remove",function(){var t=$(this);return $("<div>").html('<p>This will remove this menu item (and any children) from the interface.</p><p>You will still need to "Save Changes" to commit the removal</p>').dialog({title:"Are you sure?",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){t.closest("li.target").remove(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).show(),!1})},this._update_orders=function(t){var e=0;$("input.input-order",t).each(function(){$(this).val(e),e++})},this._update_parent_ids=function(t){$("input.input-parent_id",t).each(function(){var t=$(this).closest("ol").closest("li").data("id");$(this).val(t)})},this._generate_id=function(){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e;do{e="newid-";for(var i=this._id_length;i>0;--i)e+=t[Math.round(Math.random()*(t.length-1))]}while($("li.target-"+e).length>0);return e}};