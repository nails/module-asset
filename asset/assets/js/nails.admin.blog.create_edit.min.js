var NAILS_Admin_Blog_Create_Edit;NAILS_Admin_Blog_Create_Edit=function(){this.blog_id=null,this.upload_token=null,this._api=null,this.init=function(e,t){this.blog_id=e,this.upload_token=t,this._api=new window.NAILS_API,this._init_publish_date(),this._init_select2(),this._init_gallery(),this._init_submit()},this._init_publish_date=function(){var e=this;$("#is-published").on("change",function(){e._publish_change()}),$("#is-published").closest("div.field").on("toggle",function(){e._publish_change()}),this._publish_change()},this._publish_change=function(){var e=$("#is-published").is(":checked");if(e){$("#publish-date").show();var t=$.trim($("#publish-date input.datetime").val());if(t.length<=0){var i=new Date,a=i.getFullYear(),l=i.getMonth()+1,s=i.getDate(),o=i.getHours(),n=i.getMinutes(),r=i.getSeconds();1===l.toString().length&&(l="0"+l),1===s.toString().length&&(s="0"+s),1===o.toString().length&&(o="0"+o),1===n.toString().length&&(n="0"+n),1===r.toString().length&&(r="0"+r);var d=a+"-"+l+"-"+s+" "+o+":"+n+":"+r;$("#publish-date input.datetime").val(d)}}else $("#publish-date").hide()},this._init_select2=function(){var e=this,t={},i={};t.categories="#tab-categories select.categories",i.categories=window.SITE_URL+"admin/blog/category/index/"+this.blog_id+"?isFancybox=1",t.tags="#tab-tags select.tags",i.tags=window.SITE_URL+"admin/blog/tag/index/"+this.blog_id+"?isFancybox=1",$(document).on("click","a.manage-categories",function(){return $.fancybox.open(i.categories,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){e._rebuild_select2(t.categories)}}),!1}),$(document).on("click","a.manage-tags",function(){return $.fancybox.open(i.tags,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){e._rebuild_select2(t.tags)}}),!1}),$("ul.tabs a:not(.disabled)").on("click",function(){setTimeout(function(){$(t.categories).trigger("change"),$(t.tags).trigger("change")},1)})},this._rebuild_select2=function(e){var t=$(".fancybox-iframe").get(0).contentWindow._DATA;if("undefined"==typeof t)return!1;var i=$(e);return i.length?void i.each(function(){var e=this,i=[];$("option:selected",this).each(function(){i.push(parseInt($(this).val(),10))}),$(this).empty(),$.each(t,function(){var t=$("<option>");t.val(this.id),t.html(this.label),$.inArray(this.id,i)>-1&&t.prop("selected",!0),$(e).append(t)}),$(this).trigger("change")}):!1},this._init_gallery=function(){var e=this;$("#file_upload").uploadify({debug:!1,auto:!0,swf:window.NAILS.URL+"packages/uploadify/uploadify.swf",queueID:"gallery-items",uploader:window.SITE_URL+"api/cdnapi/object_create/script.php",fileSizeLimit:2048,fileObjName:"upload",fileTypeExts:"*.gif; *.jpg; *.jpeg; *.png",formData:{token:this.upload_token,bucket:"blog-post-gallery","return":"URL|THUMB|100x100,34x34"},itemTemplate:$("#template-uploadify").html(),onSelect:function(){$("#gallery-items li.gallery-item").length&&$("#gallery-items li.empty").fadeOut(250,function(){$(this).parent().removeClass("empty")})},onUploadStart:function(){var e="Uploading...",t=$("#post-form input[type=submit]").val();window.onbeforeunload=function(){return"Uploads are in progress. Leaving this page will cause them to stop."},$("ul.tabs li a").addClass("disabled"),$("#upload-message").show(),t!==e&&$("#post-form input[type=submit]").attr({"data-old_val":t,disabled:"disabled"}).val("Uploading...")},onQueueComplete:function(){$("#post-form").off("submit"),e._init_submit(),$("#post-form input[type=submit]").removeAttr("disabled").val($("#post-form input[type=submit]").data("old_val")),window.onbeforeunload=null,$("ul.tabs li a").removeClass("disabled"),$("#upload-message").hide()},onUploadProgress:function(e,t,i){var a=t/i*100;$("#"+e.id+" .progress").css("height",a+"%")},onUploadSuccess:function(e,t){var i;try{i=JSON.parse(t)}catch(a){i={}}var l=$.trim($("#template-gallery-item").html()),s=$($.parseHTML(l));s.attr("id",e.id+"-complete"),$("#"+e.id).replaceWith(s);var o=$("#"+e.id+"-complete");if(o.length||(l=$.trim($("#template-gallery-item").html()),s=$($.parseHTML(l)),s.attr("id",e.id+"-complete"),$("#"+e.id).replaceWith(s),o=$("#"+e.id+"-complete")),200===i.status){var n=$("<img>").attr("src",i.object_url[0]).on("load",function(){o.removeClass("crunching")}),r=$("<a>").attr({href:"#","class":"delete","data-object_id":i.object_id});o.append(n).append(r).find("input").val(i.object_id),n=$("<img>").attr({src:i.object_url[1]});var d=$("<input>").attr({type:"checkbox",value:i.object_id}),c=$("<li>").addClass("image object-id-"+i.object_id).append(d).append(n);$("#product-variations .variation").each(function(){d.attr("name","variation["+$(this).data("counter")+"][gallery][]"),$("ul.gallery-associations",this).removeClass("empty"),c.clone().insertBefore($("ul.gallery-associations li.actions",this))});var p=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));d.attr("name","variation[{{counter}}][gallery][]"),$("ul.gallery-associations",p).removeClass("empty"),c.clone().insertBefore($("ul.gallery-associations li.actions",p)),$("#template-variation").html($(p).html())}else{var u=$("<p>").addClass("filename").text(e.name),m=$("<p>").addClass("message").text(i.error);o.addClass("error").append(u).append(m).removeClass("crunching")}},onUploadError:function(e,t,i,a){var l=$("#"+e.id+"-complete");if(!l.length){var s=$.trim($("#template-gallery-item").html()),o=$($.parseHTML(s));o.attr("id",e.id+"-complete"),$("#"+e.id).replaceWith(o),l=$("#"+e.id+"-complete")}var n=$("<p>").addClass("filename").text(e.name),r=$("<p>").addClass("message").text(a);l.addClass("error").append(n).append(r).removeClass("crunching")}}),$("#gallery-items").disableSelection().sortable({placeholder:"gallery-item placeholder",items:"li.gallery-item"}),$(document).on("click","#gallery-items .gallery-item .remove",function(){var e=$(this).data("instance_id"),t=$(this).data("file_id");return $("#"+e).uploadify("cancel",t),$("#"+t+" .data-cancel").text("Cancelled").show(),$("#"+t).addClass("cancelled"),0===$("#gallery-items li.gallery-item:not(.cancelled)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250)),!1}),$(document).on("click","#gallery-items .gallery-item .delete",function(){var t=this;return $("#dialog-confirm-delete").dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{"Delete Image":function(){var i=$(t).data("object_id"),a={controller:"cdnapi",method:"object_delete",action:"POST",data:{object_id:i}};e._api.call(a),$(t).closest("li.gallery-item").addClass("deleted").fadeOut("slow",function(){$(t).closest("li.gallery-item").remove()}),$(".image.object-id-"+i).remove();var l=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));$(".image.object-id-"+i,l).remove(),0===$("#gallery-items li.gallery-item:not(.deleted)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250),$("ul.gallery-associations").addClass("empty"),$("ul.gallery-associations",l).addClass("empty")),$("#template-variation").html($(l).html()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),!1})},this._init_submit=function(){$("#post-form").on("submit",$.proxy(function(){return this._submit()},this))},this._submit=function(){var e=$("#post-form"),t=0;$("ul.tabs li a.error,div.field.error").removeClass("error"),$("div.field.error span.error").remove(),$("#body-error").hide();var i={required:'<span class="error">This field is required</span>'};$("input[name=title]",e).val().length||(t++,$("#tabber-meta").addClass("error"),$("input[name=title]",e).closest("div.field").addClass("error"),$("input[name=title]",e).closest("div.field").find("span.input").append(i.required));var a;return a="object"==typeof CKEDITOR?CKEDITOR.instances.post_body.getData().length:$("textarea[name=body]",e).val().length,a||(t++,$("#tabber-body").addClass("error"),$("textarea[name=body]",e).closest("div.field").addClass("error"),$("textarea[name=body]",e).closest("div.field").find("span.input").append(i.required)),t?($("ul.tabs a.error").first().click(),!1):!0;return t?!1:!0}};
//# sourceMappingURL=./nails.admin.blog.create_edit.min.js.map