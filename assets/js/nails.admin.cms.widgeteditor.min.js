var NAILS_Admin_CMS_WidgetEditor;NAILS_Admin_CMS_WidgetEditor=function(){var e=this;return e.widgets=[],e.actions=[{label:'<i class="fa fa-lg fa-times"></i>',type:"danger",callback:function(){e.close()}}],e.widgetData={},e.container=null,e.sections=null,e.__construct=function(){return e.log("Constructing Widget Editor"),e.generateMarkup(),e.bindEvents(),e.loadSidebarWidgets().done(function(){e.renderSidebarWidgets()}),e},e.generateMarkup=function(){var t;return null===e.container?(e.log("Injecting editor markup"),e.container=$("<div>").addClass("group-cms widgeteditor"),e.sections={header:$("<div>").addClass("widgeteditor-header").text("Some header text, maybe"),actions:$("<div>").addClass("widgeteditor-actions"),search:$("<div>").addClass("widgeteditor-search"),widgets:$("<div>").addClass("widgeteditor-widgets"),body:$("<ul>").addClass("widgeteditor-body").html('<ul></ul><div class="no-widgets">Drag widgets from the left to here</div>')},t=$("<input>").attr("type","search").attr("placeholder","Search widgets"),e.sections.search.append(t),e.container.append(e.sections.header).append(e.sections.actions).append(e.sections.search).append(e.sections.widgets).append(e.sections.body),$("body").append(e.container),e.renderSidebarWidgets(),e.renderActions(),e.sortableConstruct()):e.warn("Editor already generated"),e},e.bindEvents=function(){var t,o;return e.sections.actions.on("click",".action",function(){return t=$(this).data("action-index"),e.log("Action clicked",t),e.actions[t]?"function"==typeof e.actions[t].callback&&e.actions[t].callback.call(e):e.warn('"'+t+'" is not a valid action.'),!1}),e.sections.widgets.on("click",".widget-group",function(){e.log("Toggling visibility of group's widgets."),$(this).hasClass("closed")?$(this).removeClass("closed"):$(this).addClass("closed"),o=$(this).data("group"),$(".widget-group-"+o).toggle()}),e.sections.search.on("keyup",function(e){console.log(e.which)}),e},e.loadSidebarWidgets=function(){var t;return e.log("Fetching available CMS widgets"),t=$.Deferred(),_nails_api.call({controller:"cms/widgets",method:"index",success:function(o){e.log("Succesfully fetched widgets from the server."),e.widgets=o.widgets,t.resolve()},error:function(){e.warn("Failed to load widgets from the server."),t.reject()}}),t},e.renderSidebarWidgets=function(){e.sections.widgets.empty();var t,o,n,i,a,d;for(t=0;t<e.widgets.length;t++)for(n=$("<span>").addClass("label").text(e.widgets[t].label),i=$("<i>").addClass("icon fa fa-chevron-down"),a=$("<div>").addClass("widget-group").data("group",t).append(n).append(i),e.sections.widgets.append(a),o=0;o<e.widgets[t].widgets.length;o++)d=$("<i>").addClass("icon fa "+e.widgets[t].widgets[o].icon),n=$("<span>").addClass("label").text(e.widgets[t].widgets[o].label),a=$("<div>").addClass("widget widget-group-"+t).append(d).append(n),e.sections.widgets.append(a);return e.draggableDestroy(),e.draggableConstruct(),e},e.addAction=function(t,o,n){return e.log('Adding action "'+t+'"'),e.actions.push({label:t,type:o,callback:n}),e.renderActions(),e},e.removeAction=function(t){return e.log('Removing action "'+t+'"'),e.renderActions(),e},e.renderActions=function(){var t,o;for(e.sections.actions.empty(),t=0;t<e.actions.length;t++)o=$("<a>").addClass("action btn btn-sm btn-"+e.actions[t].type).data("action-index",t).html(e.actions[t].label),e.sections.actions.append(o);return e},e.show=function(t){return t=t||"default",e.log('Showing Editor for "'+t+'"'),e.container.addClass("active"),$("body").addClass("noscroll"),e},e.close=function(){return e.log("Closing Editor"),e.container.removeClass("active"),e.draggableDestroy(),e.sortableDestroy(),$("body").removeClass("noscroll"),$(e).trigger("widgeteditor-close"),e},e.draggableConstruct=function(){return $(e.sections.widgets).find(".widget").draggable({helper:"clone",connectToSortable:$(e.sections.body).find("> ul")}),e},e.draggableDestroy=function(){return $(e.sections.widgets).find(".widget.ui-draggable").draggable("destroy"),e},e.sortableConstruct=function(){return console.log($(e.sections.body).find("> ul")),$(e.sections.body).find("> ul").sortable({placeholder:"sortable-placeholder",start:function(e,t){t.placeholder.height(t.helper.height())}}),e},e.sortableDestroy=function(){return $(e.sections.body).find("> ul").sortable("destroy"),e},e.getData=function(t){return t=t||"default",e.log('Getting editor data for area "'+t+'"'),[{foo:"bar"},{foo:"bar"}]},e.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("CMS Widget Editor:",e,t):console.log("CMS Widget Editor:",e))},e.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("CMS Widget Editor:",e,t):console.warn("CMS Widget Editor:",e))},e.__construct()};
//# sourceMappingURL=nails.admin.cms.widgeteditor.min.js.map
