var NAILS_Admin_CMS_WidgetEditor;NAILS_Admin_CMS_WidgetEditor=function(){var e=this;return e.widgets=[],e.actions=[{label:'<i class="fa fa-lg fa-times"></i>',type:"danger",callback:function(){e.close()}}],e.widgetData={},e.container=null,e.sections=null,e.isOpen=!1,e.__construct=function(){return e.log("Constructing Widget Editor"),e.generateMarkup(),e.bindEvents(),e.loadSidebarWidgets().done(function(){e.renderSidebarWidgets()}),e},e.generateMarkup=function(){var t;return null===e.container?(e.log("Injecting editor markup"),e.container=$("<div>").addClass("group-cms widgeteditor"),e.sections={header:$("<div>").addClass("widgeteditor-header").text("Some header text, maybe"),actions:$("<div>").addClass("widgeteditor-actions"),search:$("<div>").addClass("widgeteditor-search"),widgets:$("<div>").addClass("widgeteditor-widgets"),body:$("<ul>").addClass("widgeteditor-body").html('<ul></ul><div class="no-widgets">Drag widgets from the left to here</div>')},t=$("<input>").attr("type","search").attr("placeholder","Search widgets"),e.sections.search.append(t),e.container.append(e.sections.header).append(e.sections.actions).append(e.sections.search).append(e.sections.widgets).append(e.sections.body),$("body").append(e.container),e.renderSidebarWidgets(),e.renderActions()):e.warn("Editor already generated"),e},e.bindEvents=function(){var t,i;return e.sections.actions.on("click",".action",function(){return t=$(this).data("action-index"),e.log("Action clicked",t),e.actions[t]?"function"==typeof e.actions[t].callback&&e.actions[t].callback.call(e):e.warn('"'+t+'" is not a valid action.'),!1}),e.sections.widgets.on("click",".widget-group",function(){e.log("Toggling visibility of group's widgets."),$(this).hasClass("closed")?$(this).removeClass("closed"):$(this).addClass("closed"),i=$(this).data("group"),$(".widget-group-"+i).toggle()}),e.sections.search.on("keyup",function(){var t=e.sections.search.find("input").val().trim();e.log('Filtering widgets by term "'+t+'"')}),e.sections.body.on("click",".action-remove",function(){e.log("Removing Widget"),$(this).closest(".widget").remove()}),e},e.loadSidebarWidgets=function(){var t;return e.log("Fetching available CMS widgets"),t=$.Deferred(),_nails_api.call({controller:"cms/widgets",method:"index",success:function(i){e.log("Succesfully fetched widgets from the server."),e.widgets=i.widgets,t.resolve()},error:function(){e.warn("Failed to load widgets from the server."),t.reject()}}),t},e.renderSidebarWidgets=function(){e.sections.widgets.empty();var t,i,n,o,d,a,s,r,c;for(t=0;t<e.widgets.length;t++)for(n=$("<span>").addClass("label").text(e.widgets[t].label),o=$("<i>").addClass("icon fa fa-chevron-down"),d=$("<div>").addClass("widget-group").data("group",t).append(n).append(o),e.sections.widgets.append(d),i=0;i<e.widgets[t].widgets.length;i++)a=$("<i>").addClass("icon fa "+e.widgets[t].widgets[i].icon),n=$("<span>").addClass("label").text(e.widgets[t].widgets[i].label),s=$("<div>").addClass("description").text(e.widgets[t].widgets[i].description),r=$("<a>").attr("href","#").addClass("action action-remove fa fa-trash-o"),c=$("<div>").addClass("editor-target").html("Widget Loading..."),d=$("<div>").addClass("widget widget-group-"+t).data("group",t).data("widget",i),d.append(a).append(n).append(r).append(s).append(c),e.sections.widgets.append(d);return e},e.addAction=function(t,i,n){return e.log('Adding action "'+t+'"'),e.actions.push({label:t,type:i,callback:n}),e.renderActions(),e},e.removeAction=function(t){return e.log('Removing action "'+t+'"'),e.renderActions(),e},e.renderActions=function(){var t,i;for(e.sections.actions.empty(),t=0;t<e.actions.length;t++)i=$("<a>").addClass("action btn btn-sm btn-"+e.actions[t].type).data("action-index",t).html(e.actions[t].label),e.sections.actions.append(i);return e},e.show=function(t){return t=t||"default",e.log('Showing Editor for "'+t+'"'),e.sections.body.find("> ul").empty(),e.draggableConstruct(),e.sortableConstruct(t),e.container.addClass("active"),e.isOpen=!0,$("body").addClass("noscroll"),e},e.close=function(){return e.log("Closing Editor"),e.container.removeClass("active"),e.isOpen=!0,e.draggableDestroy(),e.sortableDestroy(),$("body").removeClass("noscroll"),$(e).trigger("widgeteditor-close"),e},e.draggableConstruct=function(){return e.sections.widgets.find(".widget").draggable({helper:"clone",connectToSortable:e.sections.body.find("> ul")}),e},e.draggableDestroy=function(){return e.sections.widgets.find(".widget.ui-draggable").draggable("destroy"),e},e.sortableConstruct=function(t){return e.sections.body.find("> ul").sortable({placeholder:"sortable-placeholder",handle:".icon",receive:function(i,n){var o,d,a,s;o=n.item,d=n.helper,a=o.data("group"),s=o.data("widget"),e.addWidget(t,a,s),d.removeAttr("style")}}),e},e.sortableDestroy=function(){var t=e.sections.body.find("> ul.ui-sortable");return t.length>0&&t.sortable("destroy"),e},e.addWidget=function(t,i,n,o){if(e.widgets[i]&&e.widgets[i].widgets[n]){var d=e.widgets[i].widgets[n];e.log('Adding Widget "'+d.label+'" with data:',o),e.isOpen&&e.getWidgetEditor(i,n,o)}else e.warn("Attempted to add an invalid widget")},e.getWidgetEditor=function(t,i,n){e.log("Getting widget editor"),e.log(t),e.log(i),e.log(n)},e.getData=function(t){return t=t||"default",e.log('Getting editor data for area "'+t+'"'),[{foo:"bar"},{foo:"bar"}]},e.log=function(e,t){"function"==typeof console.log&&(void 0!==t?console.log("CMS Widget Editor:",e,t):console.log("CMS Widget Editor:",e))},e.warn=function(e,t){"function"==typeof console.warn&&(void 0!==t?console.warn("CMS Widget Editor:",e,t):console.warn("CMS Widget Editor:",e))},e.__construct()};
//# sourceMappingURL=nails.admin.cms.widgeteditor.min.js.map
