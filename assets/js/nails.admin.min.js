window._nails_admin=new function(){var t=this;return t.__construct=function(){t.initBoxes(),t.initNavSearch(),t.initNavReset(),t.initSearchBoxes(),t.initMobileMenu(),t.initNiceTime(),$(window).on("resize",(function(){t.initMatchHeights()})).trigger("resize")},t.localStorage={enabled:function(){var t,e=(new Date).toString();try{return(t=window.localStorage).setItem(e,e),t.getItem(e),t.removeItem(e),!0}catch(t){return!1}}(),set:function(t,e){return!!this.enabled&&(e=JSON.stringify(e),window.localStorage.setItem(t,e))},get:function(t){if(this.enabled){var e=window.localStorage.getItem(t);return JSON.parse(e)}return!1},remove:function(t){return!!this.enabled&&window.localStorage.removeItem(t)}},t.initBoxes=function(){var e,i,a,n;$(".box .toggle").on("click",(function(){return $(this).parents(".box").hasClass("open")?t.closeBox(this,!0):t.openBox(this,!0),t.saveNav(),!1})),$("ul.modules li.module").each((function(){e=$(this).data("initial-state"),i=$(this).find(".toggle"),n=$(this).find(".box-container"),a=n.outerHeight(),i.attr("data-height",a),"open"===e?t.openBox(i,!1):t.closeBox(i,!1)})),$("ul.modules").sortable({axis:"y",placeholder:"sort-placeholder",items:"li.module.sortable",handle:".handle",start:function(t,e){e.placeholder.height(e.helper.outerHeight())},stop:function(){t.saveNav()}})},t.saveNav=function(){var t,e;t={},$("ul.modules li.module").each((function(){e=$(".box",this).hasClass("open"),t[$(this).data("grouping")]={open:e}})),$.ajax({url:window.SITE_URL+"api/admin/nav/save",method:"POST",data:{preferences:t}})},t.openBox=function(t,e){var i;$(t).parents(".box").attr("id"),$(t).parents(".box").removeClass("closed"),$(t).parents(".box").addClass("open"),i=$(t).attr("data-height"),e?$(t).parents(".box").find(".box-container").stop().animate({height:i}):$(t).parents(".box").find(".box-container").height(i)},t.closeBox=function(t,e){$(t).parents(".box").attr("id"),$(t).parents(".box").removeClass("open"),$(t).parents(".box").addClass("closed"),e?$(t).parents(".box").find(".box-container").stop().animate({height:0}):$(t).parents(".box").find(".box-container").height(0)},t.initNavSearch=function(){$(".nav-search input").on("keyup",(function(){var e=t.normaliseSearchString($(this).val());e.length?($(".box .toggle").addClass("hidden"),$(".box li").removeClass("hidden").each((function(){var i=new RegExp(e,"gi"),a=t.normaliseSearchString($.trim($(this).text()+$(this).find("> a").data("search-terms")));i.test(a)?$(this).removeClass("hidden"):$(this).addClass("hidden")})),$(".box").each((function(){$(this).find("li:not(.hidden)").length?$(this).removeClass("hidden"):$(this).addClass("hidden");var t=$(this).find("ul").outerHeight();$(this).find(".box-container").height(t)}))):($(".box").removeClass("hidden"),$(".box li").removeClass("hidden"),$(".box .toggle").removeClass("hidden").each((function(){$(this).closest(".box").hasClass("closed")?t.closeBox(this,!1):t.openBox(this,!1)})))}))},t.normaliseSearchString=function(t){return t.replace(/[^a-zA-Z0-9]/g,"")},t.initNavReset=function(){$("#admin-nav-reset-buttons a").on("click",(function(){return"reset"===$(this).data("action")?($.ajax({url:window.SITE_URL+"api/admin/nav/reset",method:"POST"}),$("<div>").html("<p>Your navigation has been reset, changes will take hold on the next page load.</p>").dialog({title:"Reset Complete",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){$(this).dialog("close")},Reload:function(){window.location.reload()}}}).show()):"open"===$(this).data("action")?($("ul.modules li.module").each((function(){var e=$(this).find(".toggle");t.openBox(e,!1)})),t.saveNav()):"close"===$(this).data("action")&&($("ul.modules li.module").each((function(){var e=$(this).find(".toggle");t.closeBox(e,!1)})),t.saveNav()),!1}))},t.initSearchBoxes=function(){var t;$("div.search select, div.search input[type=checkbox]").on("change",(function(){var e=$(this).closest("form");clearTimeout(t),t=setTimeout((function(){e.submit()}),500)})),$("div.search form").on("submit",(function(){$(this).closest("div.search").find("div.mask").show()})),$("div.search .filterOption input[type=checkbox]").on("change",(function(){$(this).is(":checked")?$(this).closest(".filterOption").addClass("checked"):$(this).closest(".filterOption").removeClass("checked")})),$("div.search .filterOption input[type=checkbox]").each((function(){$(this).is(":checked")?$(this).closest(".filterOption").addClass("checked"):$(this).closest(".filterOption").removeClass("checked")}))},t.initMobileMenu=function(){$("#mobileMenuBurger").on("click",(function(){var t=$(window).height()-150;return $("#mobileMenu").toggleClass("open"),$("#mobileMenu").hasClass("open")?$("#mobileMenu").css("max-height",t+"px"):$("#mobileMenu").css("max-height","0px"),!1}))},t.initNiceTime=function(){$(".nice-time:not(.nice-timed)").each((function(){var t=$(this).text();if(/^\d\d\d\d-\d\d?-\d\d?(\d\d?\:\d\d?\:\d\d?)?$/.test(t)){var e=t.split(" ");if(e[1]||(e[1]="00:00:00"),e[0]){var i=e[0].split("-"),a=e[1].split(":"),n=i[0],o=i[1],s=i[2],r=a[0],h=a[1],d=a[2],c=new Date(n,o,s,r,h,d);isNaN(c.getTime())||($(this).addClass("nice-timed"),$(this).attr("data-time",t),$(this).attr("data-year",n),$(this).attr("data-month",o),$(this).attr("data-day",s),$(this).attr("data-hour",r),$(this).attr("data-minute",h),$(this).attr("data-second",d),$(this).attr("title",t))}}})),$(".nice-timed").each((function(){var e=$(this).attr("data-year"),i=$(this).attr("data-month")-1,a=$(this).attr("data-day"),n=$(this).attr("data-hour"),o=$(this).attr("data-minute"),s=$(this).attr("data-second"),r=new Date(e,i,a,n,o,s),h=new Date,d="",c=Math.ceil((h.getTime()-r.getTime())/1e3);c>=0&&c<10?d="a moment ago":c>=10?d=t.initNiceTimeCalc(c)+" ago":c<0&&(d=t.initNiceTimeCalc(c)+" from now"),"1 day ago"===d?d="yesterday":"1 day from now"===d&&(d="tomorrow"),!0===$(this).data("capitalise")&&(d=d.charAt(0).toUpperCase()+d.slice(1)),$(this).text(d)}))},t.initNiceTimeCalc=function(t){var e=0,i="";return t<0&&(t*=-1),t<60?(e=t,i="second"):t<3600?(e=Math.floor(t/60),i="minute"):t<86400?(e=Math.floor(t/60/60),i="hour"):t<604800?(e=Math.floor(t/60/60/24),i="day"):t<2592e3?(e=Math.floor(t/60/60/24/7),i="week"):t<31536e3?(e=Math.floor(t/60/60/24/30),i="month"):(e=Math.floor(t/60/60/24/365),i="year"),e+" "+i+(1===e?"":"s")},t.error=function(t){window.console&&"PRODUCTION"!==window.ENVIRONMENT&&console.error(t)},t.numberFormat=function(t,e,i,a){t=(t+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+t)?+t:0,o=isFinite(+e)?Math.abs(e):0,s=void 0===a?",":a,r=void 0===i?".":i,h="";return(h=(o?function(t,e){var i=Math.pow(10,e);return""+(Math.round(t*i)/i).toFixed(e)}(n,o):""+Math.round(n)).split("."))[0].length>3&&(h[0]=h[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),(h[1]||"").length<o&&(h[1]=h[1]||"",h[1]+=new Array(o-h[1].length+1).join("0")),h.join(r)},t.initMatchHeights=function(){var t,e,i;t={},(e=$(".match-height")).each((function(){$(this).height(""),i=$(this).data("height-group")||"default",void 0===t[i]&&(t[i]=0),$(this).height()>t[i]&&(t[i]=$(this).height())})),e.each((function(){i=$(this).data("height-group")||"default",$(this).height(t[i])}))},t.__construct()};