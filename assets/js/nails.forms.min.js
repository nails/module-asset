var NAILS_Forms;NAILS_Forms=function(){var t=this;return t.__construct=function(){t.initWidgetEditors(),t.initMultiFiles(),t.initCharCounters()},t.widgetEditor=null,t.activeArea=null,t.initWidgetEditors=function(){var i=$(".field.cms-widgets .open-editor");"function"==typeof NAILS_Admin_CMS_WidgetEditor?(i.prop("disabled",!0),t.widgetEditor=new NAILS_Admin_CMS_WidgetEditor,$(t.widgetEditor).on("widgeteditor-ready",function(){i.prop("disabled",!1)}),i.each(function(){var i=$(this).data("key"),e=$(this).siblings("textarea.widget-data");if(e.length)try{var n=JSON.parse(e.val());t.widgetEditor.setAreaData(i,n)}catch(a){t.warn("Failed to parse JSON data"),t.warn(a.message)}}),$(document).on("click",".field.cms-widgets .open-editor",function(){return t.widgetEditor.isReady()?(t.activeArea=$(this),t.log("Opening Editor for area: "+t.activeArea.data("key")),t.widgetEditor.show(t.activeArea.data("key"))):t.warn("Widget editor not ready"),!1}),$(t.widgetEditor).on("widgeteditor-close",function(){t.log("Editor Closing, getting area data and saving to input");var i=t.widgetEditor.getAreaData(t.activeArea.data("key")),e=t.activeArea.siblings("textarea.widget-data");e.length&&e.val(JSON.stringify(i)),t.activeArea=null})):i.addClass("disabled").after('<p class="alert alert-warning">Module nailsapp/module-cms is not available</p>')},t.initMultiFiles=function(){$(document).on("click",".js-cdn-multi-action-add",function(){t.log("MultiFile: Adding Row");var i=$(this).closest(".field"),e=i.data("items")||[],n={id:null,object_id:null,label:null};return e.push(n),i.data("items",e),t.renderMultFiles(i,e),!1}),$(document).on("click",".js-cdn-multi-action-remove",function(){t.log("MultiFile: Removing Row");for(var i=$(this).data("index"),e=$(this).closest(".field"),n=e.data("items")||[],a=[],d=0;d<n.length;d++)d!==i&&a.push(n[d]);return t.renderMultFiles(e,a),e.data("items",a),!1}),$(".field.cdn-multi").each(function(){var i=$(this).data("defaults");$(this).data("items",i),$(this).find(".cdn-object-picker").on("picked",function(){t.multiCdnPicked($(this))}),$(this).find(".js-label").on("keyup",function(){t.multiLabelChanged($(this))})})},t.renderMultFiles=function(i,e){t.log("MultiFile: Rendering",e);var n=i.find(".js-row-target"),a=i.children(".js-row-tpl").html(),d="";n.empty();for(var o=0;o<e.length;o++)e[o].index=o,d=Mustache.render(a,e[o]),d=$(d),d.find(".cdn-object-picker").on("picked",function(){t.multiCdnPicked($(this))}),d.find(".js-label").on("keyup",function(){t.multiLabelChanged($(this))}),n.append(d);_CDN_OBJECTPICKER.initPickers()},t.multiCdnPicked=function(i){for(var e=i.data("index"),n=i.closest(".field"),a=n.data("items")||[],d=0;d<a.length;d++)if(d===e){t.log("Updating object ID to "+i.find(".cdn-object-picker__input").val()),t.log("At index: "+e),a[d].object_id=parseInt(i.find(".cdn-object-picker__input").val(),10)||null;break}n.data("items",a)},t.multiLabelChanged=function(i){for(var e=i.data("index"),n=i.closest(".field"),a=n.data("items")||[],d=0;d<a.length;d++)if(d===e){t.log("Updating label"),a[d].label=i.val();break}n.data("items",a)},t.initCharCounters=function(){$(".field .char-count:not(.counting)").each(function(){var t=$(this),i=t.data("max-length"),e=$(this).closest(".field"),n=$(this).closest(".input").find(".field-input");n.length&&n.on("keyup",function(){var n=$(this).val().length;n>i?e.addClass("max-length-exceeded"):e.removeClass("max-length-exceeded"),t.html(n+" of "+i+" characters")}).trigger("keyup"),t.addClass("counting")})},t.log=function(t,i){"function"==typeof console.log&&(void 0!==i?console.log("Nails Forms:",t,i):console.log("Nails Forms:",t))},t.warn=function(t,i){"function"==typeof console.warn&&(void 0!==i?console.warn("Nails Forms:",t,i):console.warn("Nails Forms:",t))},t.__construct()};
//# sourceMappingURL=nails.forms.min.js.map
