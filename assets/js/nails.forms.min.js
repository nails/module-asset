!function(){var t=this;t.__construct=function(){t.initMultiFiles(),t.initCharCounters()},t.initMultiFiles=function(){$(document).on("click",".js-cdn-multi-action-add",(function(){t.log("MultiFile: Adding Row");var i=$(this).closest(".field"),n=i.data("items")||[],e={id:null,object_id:null};return e[i.data("label-key")]=null,n.push(e),i.data("items",n),t.renderMultFiles(i,n),!1})),$(document).on("click",".js-cdn-multi-action-remove",(function(){t.log("MultiFile: Removing Row");for(var i=$(this).data("index"),n=$(this).closest(".field"),e=n.data("items")||[],l=[],a=0;a<e.length;a++)a!==i&&l.push(e[a]);return t.renderMultFiles(n,l),n.data("items",l),!1})),$(".field.cdn-multi").each((function(){var i=$(this).data("defaults"),n=$(this).data("label-key");$(this).data("items",i).data("label-key",n),$(this).find(".cdn-object-picker").on("picked",(function(){t.multiCdnPicked($(this))})),$(this).find(".js-label").on("keyup",(function(){t.multiLabelChanged($(this))}))}))},t.renderMultFiles=function(i,n){t.log("MultiFile: Rendering",n);var e=i.find(".js-row-target"),l=i.children(".js-row-tpl").html(),a="";e.empty();for(var o=0;o<n.length;o++)n[o].index=o,a=Mustache.render(l,n[o]),(a=$(a)).find(".cdn-object-picker").on("picked",(function(){t.multiCdnPicked($(this))})),a.find(".js-label").on("keyup",(function(){t.multiLabelChanged($(this))})),e.append(a);window.NAILS.ADMIN.getInstance("ObjectPicker","nails/module-cdn").initPickers()},t.multiCdnPicked=function(i){for(var n=i.data("index"),e=i.closest(".field"),l=e.data("items")||[],a=0;a<l.length;a++)if(a===n){t.log("Updating object ID to "+i.find(".cdn-object-picker__input").val()),t.log("At index: "+n),l[a].object_id=parseInt(i.find(".cdn-object-picker__input").val(),10)||null;break}e.data("items",l)},t.multiLabelChanged=function(i){for(var n=i.data("index"),e=i.closest(".field"),l=e.data("items")||[],a=0;a<l.length;a++)if(a===n){t.log("Updating label"),l[a][e.data("label-key")]=i.val();break}e.data("items",l)},t.initCharCounters=function(){$(".field .char-count:not(.counting)").each((function(){var t=$(this),i=t.data("max-length"),n=$(this).closest(".field"),e=$(this).closest(".input").find(".field-input");e.length&&e.on("keyup",(function(){var e=$(this).val().length;e>i?n.addClass("max-length-exceeded"):n.removeClass("max-length-exceeded"),t.html(e+" of "+i+" characters")})).trigger("keyup"),t.addClass("counting")}))},t.log=function(t,i){"function"==typeof console.log&&(void 0!==i?console.log("Nails Forms:",t,i):console.log("Nails Forms:",t))},t.warn=function(t,i){"function"==typeof console.warn&&(void 0!==i?console.warn("Nails Forms:",t,i):console.warn("Nails Forms:",t))},t.__construct()}();