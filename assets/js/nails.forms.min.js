window._nails_forms=new function(){var t=this;return t.__construct=function(){t.initMultiFiles(),t.initCharCounters()},t.initMultiFiles=function(){$(document).on("click",".js-cdn-multi-action-add",(function(){t.log("MultiFile: Adding Row");var n=$(this).closest(".field"),i=n.data("items")||[],e={id:null,object_id:null};return e[n.data("label-key")]=null,i.push(e),n.data("items",i),t.renderMultFiles(n,i),!1})),$(document).on("click",".js-cdn-multi-action-remove",(function(){t.log("MultiFile: Removing Row");for(var n=$(this).data("index"),i=$(this).closest(".field"),e=i.data("items")||[],l=[],a=0;a<e.length;a++)a!==n&&l.push(e[a]);return t.renderMultFiles(i,l),i.data("items",l),!1})),$(".field.cdn-multi").each((function(){var n=$(this).data("defaults"),i=$(this).data("label-key");$(this).data("items",n).data("label-key",i),$(this).find(".cdn-object-picker").on("picked",(function(){t.multiCdnPicked($(this))})),$(this).find(".js-label").on("keyup",(function(){t.multiLabelChanged($(this))}))}))},t.renderMultFiles=function(n,i){t.log("MultiFile: Rendering",i);var e=n.find(".js-row-target"),l=n.children(".js-row-tpl").html(),a="";e.empty();for(var o=0;o<i.length;o++)i[o].index=o,a=Mustache.render(l,i[o]),(a=$(a)).find(".cdn-object-picker").on("picked",(function(){t.multiCdnPicked($(this))})),a.find(".js-label").on("keyup",(function(){t.multiLabelChanged($(this))})),e.append(a);window.NAILS.ADMIN.getInstance("ObjectPicker","nails/module-cdn").initPickers()},t.multiCdnPicked=function(n){for(var i=n.data("index"),e=n.closest(".field"),l=e.data("items")||[],a=0;a<l.length;a++)if(a===i){t.log("Updating object ID to "+n.find(".cdn-object-picker__input").val()),t.log("At index: "+i),l[a].object_id=parseInt(n.find(".cdn-object-picker__input").val(),10)||null;break}e.data("items",l)},t.multiLabelChanged=function(n){for(var i=n.data("index"),e=n.closest(".field"),l=e.data("items")||[],a=0;a<l.length;a++)if(a===i){t.log("Updating label"),l[a][e.data("label-key")]=n.val();break}e.data("items",l)},t.initCharCounters=function(){$(".field .char-count:not(.counting)").each((function(){var t=$(this),n=t.data("max-length"),i=$(this).closest(".field"),e=$(this).closest(".input").find(".field-input");e.length&&e.on("keyup",(function(){var e=$(this).val().length;e>n?i.addClass("max-length-exceeded"):i.removeClass("max-length-exceeded"),t.html(e+" of "+n+" characters")})).trigger("keyup"),t.addClass("counting")}))},t.log=function(t,n){"function"==typeof console.log&&(void 0!==n?console.log("Nails Forms:",t,n):console.log("Nails Forms:",t))},t.warn=function(t,n){"function"==typeof console.warn&&(void 0!==n?console.warn("Nails Forms:",t,n):console.warn("Nails Forms:",t))},t.__construct()};