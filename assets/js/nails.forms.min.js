var NAILS_Forms;NAILS_Forms=function(){var o=this;return o.__construct=function(){o.initWidgetEditors(),o.initMultiFiles(),o.initCharCounters()},o.widgetEditor=null,o.activeArea=null,o.initWidgetEditors=function(){var t=$(".field.cms-widgets .open-editor");"object"==typeof window.WidgetEditor?(t.prop("disabled",!0),o.widgetEditor=new window.WidgetEditor.default,o.widgetEditor.construct(),$(o.widgetEditor).on("widgeteditor-ready",function(){t.prop("disabled",!1)}),t.each(function(){var t=$(this).data("key"),i=$(this).siblings("textarea.widget-data");if(i.length)try{var e=JSON.parse(i.val());o.widgetEditor.setAreaData(t,e)}catch(t){o.warn("Failed to parse JSON data"),o.warn(t.message)}}),$(document).on("click",".field.cms-widgets .open-editor",function(){return o.widgetEditor.isReady()?(o.activeArea=$(this),o.log("Opening Editor for area: "+o.activeArea.data("key")),o.widgetEditor.show(o.activeArea.data("key"))):o.warn("Widget editor not ready"),!1}),$(o.widgetEditor).on("widgeteditor-close",function(){o.log("Editor Closing, getting area data and saving to input");var t=o.widgetEditor.getAreaData(o.activeArea.data("key")),i=o.activeArea.siblings("textarea.widget-data");i.length&&i.val(JSON.stringify(t)).trigger("change"),o.activeArea=null})):t.addClass("disabled").after('<p class="alert alert-warning">Module nails/module-cms is not available</p>')},o.initMultiFiles=function(){$(document).on("click",".js-cdn-multi-action-add",function(){o.log("MultiFile: Adding Row");var t=$(this).closest(".field"),i=t.data("items")||[],e={id:null,object_id:null};return e[t.data("label-key")]=null,i.push(e),t.data("items",i),o.renderMultFiles(t,i),!1}),$(document).on("click",".js-cdn-multi-action-remove",function(){o.log("MultiFile: Removing Row");for(var t=$(this).data("index"),i=$(this).closest(".field"),e=i.data("items")||[],n=[],a=0;a<e.length;a++)a!==t&&n.push(e[a]);return o.renderMultFiles(i,n),i.data("items",n),!1}),$(".field.cdn-multi").each(function(){var t=$(this).data("defaults"),i=$(this).data("label-key");$(this).data("items",t).data("label-key",i),$(this).find(".cdn-object-picker").on("picked",function(){o.multiCdnPicked($(this))}),$(this).find(".js-label").on("keyup",function(){o.multiLabelChanged($(this))})})},o.renderMultFiles=function(t,i){o.log("MultiFile: Rendering",i);var e=t.find(".js-row-target"),n=t.children(".js-row-tpl").html(),a="";e.empty();for(var d=0;d<i.length;d++)i[d].index=d,a=Mustache.render(n,i[d]),(a=$(a)).find(".cdn-object-picker").on("picked",function(){o.multiCdnPicked($(this))}),a.find(".js-label").on("keyup",function(){o.multiLabelChanged($(this))}),e.append(a);window.NAILS.CDN.ObjectPicker.initPickers()},o.multiCdnPicked=function(t){for(var i=t.data("index"),e=t.closest(".field"),n=e.data("items")||[],a=0;a<n.length;a++)if(a===i){o.log("Updating object ID to "+t.find(".cdn-object-picker__input").val()),o.log("At index: "+i),n[a].object_id=parseInt(t.find(".cdn-object-picker__input").val(),10)||null;break}e.data("items",n)},o.multiLabelChanged=function(t){for(var i=t.data("index"),e=t.closest(".field"),n=e.data("items")||[],a=0;a<n.length;a++)if(a===i){o.log("Updating label"),n[a][e.data("label-key")]=t.val();break}e.data("items",n)},o.initCharCounters=function(){$(".field .char-count:not(.counting)").each(function(){var i=$(this),e=i.data("max-length"),n=$(this).closest(".field"),t=$(this).closest(".input").find(".field-input");t.length&&t.on("keyup",function(){var t=$(this).val().length;e<t?n.addClass("max-length-exceeded"):n.removeClass("max-length-exceeded"),i.html(t+" of "+e+" characters")}).trigger("keyup"),i.addClass("counting")})},o.log=function(t,i){"function"==typeof console.log&&(void 0!==i?console.log("Nails Forms:",t,i):console.log("Nails Forms:",t))},o.warn=function(t,i){"function"==typeof console.warn&&(void 0!==i?console.warn("Nails Forms:",t,i):console.warn("Nails Forms:",t))},o.__construct()};
//# sourceMappingURL=nails.forms.min.js.map
